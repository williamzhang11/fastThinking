# 什么是分布式事务

分布式事务就是指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的分
布式系统的不同节点之上。简单的说，就是一次大的操作由不同的小操作组成，这些小的操作分布在
不同的服务器上，且属于不同的应用，分布式事务需要保证这些小操作要么全部成功，要么全部失败
。本质上来说，分布式事务就是为了保证不同数据库的数据一致性。

或者，在换一句话说，分布式事务 = n 个本地事务。通过事务管理器，达到 n 个本地事务要么全部成功，要么全部失败。

## 分布式事务的基础

数据库的 ACID 满足了数据库本地事务的基础，但是它无法满足分布式事务，这个时候衍生了 CAP 和 BASE 两个经典理论。

### CAP 理论

CAP 定理，又被叫作布鲁尔定理。对于设计分布式系统来说(不仅仅是分布式事务)的架构师来说，CAP 就是你的入门理论。

C (一致性)：在分布式系统中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问
同一份最新的数据副本）
A (可用性)：在集群中一部分节点故障后，集群整体是否还能响应客户端的读写请求。（对数
据更新具备高可用性）
P (分区容错性)：以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据
一致性，就意味着发生了分区的情况，必须就当前操作在 C 和 A 之间做出选择。


高可用、数据一致性是很多系统设计的目标，但是分区又是不可避免的事情。我们来看一看分别拥有 CA、CP 和 AP 的情况。

MySQL 主从异步复制是 AP 系统。

MySQL 主从半同步复制是 CP 系统。

Zookeeper 是 CP 系统。

Redis 主从同步是 AP 系统。

Eureka 主从同步是 AP 系统。

## BASE 理论

BASE 是 Basically Available(基本可用)、Soft state(软状态)和 Eventually consis
tent (最终一致性) 三个短语的缩写。是对 CAP 中AP 的一个扩展

BA 基本可用：分布式系统在出现故障时，允许损失部分可用功能，保证核心功能可用。

S 软状态：允许系统中存在中间状态，这个状态不影响系统可用性，这里指的是 CAP 中的不一致。

E 最终一致：最终一致是指经过一段时间后，所有节点数据都将会达到一致。

BASE 解决了 CAP 中理论没有网络延迟，在 BASE 中用软状态和最终一致，保证了延迟后的一致性
BASE 和 ACID 是相反的，它完全不同于 ACID 的强一致性模型，而是通过牺牲强一致性来获得可用性，
并允许数据在一段时间内是不一致的，但最终达到一致状态。

对于大部分的分布式应用而言，只要数据在规定的时间内达到最终一致性即可。我们可以把符合传统的
 ACID 叫做刚性事务，把满足 BASE 理论的最终一致性事务叫做柔性事务
 
 市面上的分布式事务的解决方案，除了 XA 协议是强一直的，其他都是最终一致的
 
 






